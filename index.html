<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oracle 抢机实时日志</title>
    <style>
        /* 样式部分保持不变 */
        html { height: 100%; }
        body {
            margin: 0;
            background-color: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Monaco', 'Menlo', 'Consolas', 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        #header {
            background-color: #333;
            padding: 12px 25px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            text-align: center;
            flex-shrink: 0;
        }
        #header h1 { margin: 0; font-size: 1.4em; }
        #table-container {
            flex-grow: 1;
            display: flex;
            padding: 20px;
            box-sizing: border-box;
            overflow: hidden;
        }
        table {
            max-width: 980px;
            margin: 0 auto;
            border-collapse: separate;
            border-spacing: 0;
            height: 100%;
        }
        #log-body {
            display: flex;
            flex-direction: column;
            height: 100%;
            gap: 8px;
        }
        tr {
            flex-grow: 1;
            display: flex;
            align-items: center;
            border-radius: 6px;
        }
        tr:nth-child(odd) { background-color: #3c3c3c; }
        tr:nth-child(even) { background-color: #2a2d2e; }
        td { padding: 15px 25px; line-height: 1.6; width: 100%; }
        tr:hover { background-color: #555; }
    </style>
</head>
<body>
    <div id="header">
        <h1>Oracle 抢机实时日志</h1>
    </div>
    <div id="table-container">
        <table>
            <tbody id="log-body">
                </tbody>
        </table>
    </div>

    <script>
        const logBody = document.getElementById('log-body');

        // 定义一个函数来获取并更新日志
        async function fetchLogs() {
            try {
                // 使用 fetch API 去请求新的 /get-logs 接口
                const response = await fetch('/get-logs');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                // 解析返回的 JSON 数据（一个包含日志行的数组）
                const lines = await response.json();

                // 先清空当前的表格内容
                logBody.innerHTML = '';

                // 遍历获取到的新数据，并创建表格行
                lines.forEach(line => {
                    if (!line) return;
                    const tr = document.createElement('tr');
                    tr.innerHTML = `<td>${line}</td>`;
                    logBody.appendChild(tr);
                });

            } catch (error) {
                console.error("Failed to fetch logs:", error);
                logBody.innerHTML = `<tr><td>获取日志失败，请检查网络或后台服务...</td></tr>`;
            }
        }

        // 1. 页面加载后立即执行一次，马上看到内容
        fetchLogs();

        // 2. 设置一个定时器，每 2 分钟（120000毫秒）执行一次 fetchLogs 函数
        setInterval(fetchLogs, 120000);

    </script>
</body>
</html>